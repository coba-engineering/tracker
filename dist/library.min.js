!function(f){"object"==typeof exports&&"undefined"!=typeof module?module.exports=f():"function"==typeof define&&define.amd?define([],f):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).myLibraryName=f()}(function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var p="function"==typeof require&&require;if(!f&&p)return p(i,!0);if(u)return u(i,!0);throw(p=new Error("Cannot find module '"+i+"'")).code="MODULE_NOT_FOUND",p}p=n[i]={exports:{}},e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}({1:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const fetch_1=require("./lib/fetch"),constants_1=require("./lib/constants"),cookies_1=require("./lib/cookies"),helpers_1=require("./lib/helpers");exports.default=class{constructor({url="",headers={},cookieOptions}){this.url=url,this.headers=headers,this.cookieOptions=Object.assign(Object.assign({},constants_1.COOKIE_OPTIONS),cookieOptions)}signUpWithEmail(email,password,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);let queryString="";options.redirectTo&&(queryString="?redirect_to="+encodeURIComponent(options.redirectTo));var data=yield fetch_1.post(`${this.url}/signup${queryString}`,{email:email,password:password,data:options.data},{headers:headers});let session=Object.assign({},data);return session.expires_in&&(session.expires_at=helpers_1.expiresAt(data.expires_in)),{data:session,error:null}}catch(error){return{data:null,error:error}}})}signInWithEmail(email,password,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);let queryString="?grant_type=password";options.redirectTo&&(queryString+="&redirect_to="+encodeURIComponent(options.redirectTo));var data=yield fetch_1.post(`${this.url}/token${queryString}`,{email:email,password:password},{headers:headers});let session=Object.assign({},data);return session.expires_in&&(session.expires_at=helpers_1.expiresAt(data.expires_in)),{data:session,error:null}}catch(error){return{data:null,error:error}}})}signUpWithPhone(phone,password,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers),data=yield fetch_1.post(`${this.url}/signup`,{phone:phone,password:password,data:options.data},{headers:headers});let session=Object.assign({},data);return session.expires_in&&(session.expires_at=helpers_1.expiresAt(data.expires_in)),{data:session,error:null}}catch(error){return{data:null,error:error}}})}signInWithPhone(phone,password){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers),data=yield fetch_1.post(`${this.url}/token?grant_type=password`,{phone:phone,password:password},{headers:headers});let session=Object.assign({},data);return session.expires_in&&(session.expires_at=helpers_1.expiresAt(data.expires_in)),{data:session,error:null}}catch(error){return{data:null,error:error}}})}sendMagicLinkEmail(email,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);let queryString="";return options.redirectTo&&(queryString+="?redirect_to="+encodeURIComponent(options.redirectTo)),{data:yield fetch_1.post(`${this.url}/magiclink${queryString}`,{email:email},{headers:headers}),error:null}}catch(error){return{data:null,error:error}}})}sendMobileOTP(phone){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);return{data:yield fetch_1.post(`${this.url}/otp`,{phone:phone},{headers:headers}),error:null}}catch(error){return{data:null,error:error}}})}verifyMobileOTP(phone,token,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);return{data:yield fetch_1.post(`${this.url}/verify`,{phone:phone,token:token,type:"sms",redirect_to:options.redirectTo},{headers:headers}),error:null}}catch(error){return{data:null,error:error}}})}inviteUserByEmail(email,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);let queryString="";return options.redirectTo&&(queryString+="?redirect_to="+encodeURIComponent(options.redirectTo)),{data:yield fetch_1.post(`${this.url}/invite${queryString}`,{email:email,data:options.data},{headers:headers}),error:null}}catch(error){return{data:null,error:error}}})}resetPasswordForEmail(email,options={}){return __awaiter(this,void 0,void 0,function*(){try{var headers=Object.assign({},this.headers);let queryString="";return options.redirectTo&&(queryString+="?redirect_to="+encodeURIComponent(options.redirectTo)),{data:yield fetch_1.post(`${this.url}/recover${queryString}`,{email:email},{headers:headers}),error:null}}catch(error){return{data:null,error:error}}})}_createRequestHeaders(jwt){const headers=Object.assign({},this.headers);return headers.Authorization=`Bearer ${jwt}`,headers}signOut(jwt){return __awaiter(this,void 0,void 0,function*(){try{return yield fetch_1.post(`${this.url}/logout`,{},{headers:this._createRequestHeaders(jwt),noResolveJson:!0}),{error:null}}catch(error){return{error:error}}})}getUrlForProvider(provider,options){let urlParams=[`provider=${encodeURIComponent(provider)}`];return null!=options&&options.redirectTo&&urlParams.push(`redirect_to=${encodeURIComponent(options.redirectTo)}`),null!=options&&options.scopes&&urlParams.push(`scopes=${encodeURIComponent(options.scopes)}`),`${this.url}/authorize?${urlParams.join("&")}`}getUser(jwt){return __awaiter(this,void 0,void 0,function*(){try{var data=yield fetch_1.get(`${this.url}/user`,{headers:this._createRequestHeaders(jwt)});return{user:data,data:data,error:null}}catch(error){return{user:null,data:null,error:error}}})}updateUser(jwt,attributes){return __awaiter(this,void 0,void 0,function*(){try{var data=yield fetch_1.put(`${this.url}/user`,attributes,{headers:this._createRequestHeaders(jwt)});return{user:data,data:data,error:null}}catch(error){return{user:null,data:null,error:error}}})}deleteUser(uid,jwt){return __awaiter(this,void 0,void 0,function*(){try{var data=yield fetch_1.remove(`${this.url}/admin/users/${uid}`,{},{headers:this._createRequestHeaders(jwt)});return{user:data,data:data,error:null}}catch(error){return{user:null,data:null,error:error}}})}refreshAccessToken(refreshToken){return __awaiter(this,void 0,void 0,function*(){try{var data=yield fetch_1.post(`${this.url}/token?grant_type=refresh_token`,{refresh_token:refreshToken},{headers:this.headers});let session=Object.assign({},data);return session.expires_in&&(session.expires_at=helpers_1.expiresAt(data.expires_in)),{data:session,error:null}}catch(error){return{data:null,error:error}}})}setAuthCookie(req,res){"POST"!==req.method&&(res.setHeader("Allow","POST"),res.status(405).end("Method Not Allowed"));var{event,session}=req.body;if(!event)throw new Error("Auth event missing!");if("SIGNED_IN"===event){if(!session)throw new Error("Auth session missing!");cookies_1.setCookie(req,res,{name:this.cookieOptions.name,value:session.access_token,domain:this.cookieOptions.domain,maxAge:this.cookieOptions.lifetime,path:this.cookieOptions.path,sameSite:this.cookieOptions.sameSite})}"SIGNED_OUT"===event&&cookies_1.deleteCookie(req,res,this.cookieOptions.name),res.status(200).json({})}getUserByCookie(req){return __awaiter(this,void 0,void 0,function*(){try{if(!req.cookies)throw new Error("Not able to parse cookies! When using Express make sure the cookie-parser middleware is in use!");if(!req.cookies[this.cookieOptions.name])throw new Error("No cookie found!");var token=req.cookies[this.cookieOptions.name],{user,error}=yield this.getUser(token);if(error)throw error;return{user:user,data:user,error:null}}catch(error){return{user:null,data:null,error:error}}})}generateLink(type,email,options={}){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.post(`${this.url}/admin/generate_link`,{type:type,email:email,password:options.password,data:options.data,redirect_to:options.redirectTo},{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}}},{"./lib/constants":4,"./lib/cookies":5,"./lib/fetch":6,"./lib/helpers":7}],2:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const GoTrueApi_1=__importDefault(require("./GoTrueApi")),helpers_1=require("./lib/helpers"),constants_1=require("./lib/constants"),polyfills_1=require("./lib/polyfills");polyfills_1.polyfillGlobalThis();const DEFAULT_OPTIONS={url:constants_1.GOTRUE_URL,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:constants_1.DEFAULT_HEADERS};exports.default=class{constructor(settings){this.stateChangeEmitters=new Map;settings=Object.assign(Object.assign({},DEFAULT_OPTIONS),settings);this.currentUser=null,this.currentSession=null,this.autoRefreshToken=settings.autoRefreshToken,this.persistSession=settings.persistSession,this.localStorage=settings.localStorage||globalThis.localStorage,this.api=new GoTrueApi_1.default({url:settings.url,headers:settings.headers,cookieOptions:settings.cookieOptions}),this._recoverSession(),this._recoverAndRefresh();try{settings.detectSessionInUrl&&helpers_1.isBrowser()&&helpers_1.getParameterByName("access_token")&&this.getSessionFromUrl({storeSession:!0})}catch(error){console.log("Error getting session from URL.")}}signUp({email,password,phone},options={}){return __awaiter(this,void 0,void 0,function*(){try{this._removeSession();var{data,error}=phone&&password?yield this.api.signUpWithPhone(phone,password,{data:options.data}):yield this.api.signUpWithEmail(email,password,{redirectTo:options.redirectTo,data:options.data});if(error)throw error;if(!data)throw"An error occurred on sign up.";let session=null,user=null;return data.access_token&&(session=data,user=session.user,this._saveSession(session),this._notifyAllSubscribers("SIGNED_IN")),data.id&&(user=data),{data:data,user:user,session:session,error:null}}catch(error){return{data:null,user:null,session:null,error:error}}})}signIn({email,phone,password,refreshToken,provider},options={}){return __awaiter(this,void 0,void 0,function*(){try{if(this._removeSession(),email&&!password){var error=(yield this.api.sendMagicLinkEmail(email,{redirectTo:options.redirectTo}))["error"];return{data:null,user:null,session:null,error:error}}if(email&&password)return this._handleEmailSignIn(email,password,{redirectTo:options.redirectTo});if(phone&&!password){const error=(yield this.api.sendMobileOTP(phone))["error"];return{data:null,user:null,session:null,error:error}}if(phone&&password)return this._handlePhoneSignIn(phone,password);if(refreshToken){const error=(yield this._callRefreshToken(refreshToken))["error"];if(error)throw error;return{data:this.currentSession,user:this.currentUser,session:this.currentSession,error:null}}if(provider)return this._handleProviderSignIn(provider,{redirectTo:options.redirectTo,scopes:options.scopes});throw new Error("You must provide either an email, phone number or a third-party provider.")}catch(error){return{data:null,user:null,session:null,error:error}}})}verifyOTP({phone,token},options={}){return __awaiter(this,void 0,void 0,function*(){try{this._removeSession();var{data,error}=yield this.api.verifyMobileOTP(phone,token,options);if(error)throw error;if(!data)throw"An error occurred on token verification.";let session=null,user=null;return data.access_token&&(session=data,user=session.user,this._saveSession(session),this._notifyAllSubscribers("SIGNED_IN")),data.id&&(user=data),{data:data,user:user,session:session,error:null}}catch(error){return{data:null,user:null,session:null,error:error}}})}user(){return this.currentUser}session(){return this.currentSession}refreshSession(){var _a;return __awaiter(this,void 0,void 0,function*(){try{if(null===(_a=this.currentSession)||void 0===_a||!_a.access_token)throw new Error("Not logged in.");var error=(yield this._callRefreshToken())["error"];if(error)throw error;return{data:this.currentSession,user:this.currentUser,error:null}}catch(error){return{data:null,user:null,error:error}}})}update(attributes){var _a;return __awaiter(this,void 0,void 0,function*(){try{if(null===(_a=this.currentSession)||void 0===_a||!_a.access_token)throw new Error("Not logged in.");var{user,error}=yield this.api.updateUser(this.currentSession.access_token,attributes);if(error)throw error;if(!user)throw Error("Invalid user data.");var session=Object.assign(Object.assign({},this.currentSession),{user:user});return this._saveSession(session),this._notifyAllSubscribers("USER_UPDATED"),{data:user,user:user,error:null}}catch(error){return{data:null,user:null,error:error}}})}setSession(refresh_token){return __awaiter(this,void 0,void 0,function*(){try{if(!refresh_token)throw new Error("No current session.");var{data,error}=yield this.api.refreshAccessToken(refresh_token);return error?{session:null,error:error}:data?(this._saveSession(data),this._notifyAllSubscribers("SIGNED_IN"),{session:data,error:null}):{session:null,error:{name:"Invalid refresh_token",message:"JWT token provided is Invalid"}}}catch(error){return{error:error,session:null}}})}setAuth(access_token){return this.currentSession=Object.assign(Object.assign({},this.currentSession),{access_token:access_token,token_type:"bearer",user:null}),this.currentSession}getSessionFromUrl(options){return __awaiter(this,void 0,void 0,function*(){try{if(!helpers_1.isBrowser())throw new Error("No browser detected.");var error_description=helpers_1.getParameterByName("error_description");if(error_description)throw new Error(error_description);var provider_token=helpers_1.getParameterByName("provider_token"),access_token=helpers_1.getParameterByName("access_token");if(!access_token)throw new Error("No access_token detected.");var expires_in=helpers_1.getParameterByName("expires_in");if(!expires_in)throw new Error("No expires_in detected.");var refresh_token=helpers_1.getParameterByName("refresh_token");if(!refresh_token)throw new Error("No refresh_token detected.");var token_type=helpers_1.getParameterByName("token_type");if(!token_type)throw new Error("No token_type detected.");var expires_at=Math.round(Date.now()/1e3)+parseInt(expires_in),{user,error}=yield this.api.getUser(access_token);if(error)throw error;var session={provider_token:provider_token,access_token:access_token,expires_in:parseInt(expires_in),expires_at:expires_at,refresh_token:refresh_token,token_type:token_type,user:user};return null!=options&&options.storeSession&&(this._saveSession(session),this._notifyAllSubscribers("SIGNED_IN"),"recovery"===helpers_1.getParameterByName("type")&&this._notifyAllSubscribers("PASSWORD_RECOVERY")),window.location.hash="",{data:session,error:null}}catch(error){return{data:null,error:error}}})}signOut(){var _a;return __awaiter(this,void 0,void 0,function*(){var error=null===(_a=this.currentSession)||void 0===_a?void 0:_a.access_token;if(this._removeSession(),this._notifyAllSubscribers("SIGNED_OUT"),error){var error=(yield this.api.signOut(error))["error"];if(error)return{error:error}}return{error:null}})}onAuthStateChange(callback){try{const id=helpers_1.uuid(),self=this;var subscription={id:id,callback:callback,unsubscribe:()=>{self.stateChangeEmitters.delete(id)}};return this.stateChangeEmitters.set(id,subscription),{data:subscription,error:null}}catch(error){return{data:null,error:error}}}_handleEmailSignIn(email,password,options={}){var _a,_b;return __awaiter(this,void 0,void 0,function*(){try{var{data,error}=yield this.api.signInWithEmail(email,password,{redirectTo:options.redirectTo});return error||!data?{data:null,user:null,session:null,error:error}:((null!==(_a=null==data?void 0:data.user)&&void 0!==_a&&_a.confirmed_at||null!==(_b=null==data?void 0:data.user)&&void 0!==_b&&_b.email_confirmed_at)&&(this._saveSession(data),this._notifyAllSubscribers("SIGNED_IN")),{data:data,user:data.user,session:data,error:null})}catch(error){return{data:null,user:null,session:null,error:error}}})}_handlePhoneSignIn(phone,password){var _a;return __awaiter(this,void 0,void 0,function*(){try{var{data,error}=yield this.api.signInWithPhone(phone,password);return error||!data?{data:null,user:null,session:null,error:error}:(null!==(_a=null==data?void 0:data.user)&&void 0!==_a&&_a.phone_confirmed_at&&(this._saveSession(data),this._notifyAllSubscribers("SIGNED_IN")),{data:data,user:data.user,session:data,error:null})}catch(error){return{data:null,user:null,session:null,error:error}}})}_handleProviderSignIn(provider,url={}){url=this.api.getUrlForProvider(provider,{redirectTo:url.redirectTo,scopes:url.scopes});try{return helpers_1.isBrowser()&&(window.location.href=url),{provider:provider,url:url,data:null,session:null,user:null,error:null}}catch(error){return url?{provider:provider,url:url,data:null,session:null,user:null,error:null}:{data:null,user:null,session:null,error:error}}}_recoverSession(){var _a;try{var json=helpers_1.isBrowser()&&(null===(_a=this.localStorage)||void 0===_a?void 0:_a.getItem(constants_1.STORAGE_KEY));if(!json||"string"!=typeof json)return null;var{currentSession,expiresAt}=JSON.parse(json);Math.round(Date.now()/1e3)<=expiresAt&&null!=currentSession&&currentSession.user&&(this._saveSession(currentSession),this._notifyAllSubscribers("SIGNED_IN"))}catch(error){console.log("error",error)}}_recoverAndRefresh(){return __awaiter(this,void 0,void 0,function*(){try{var json=helpers_1.isBrowser()&&(yield this.localStorage.getItem(constants_1.STORAGE_KEY));if(!json)return null;var error,{currentSession,expiresAt}=JSON.parse(json);expiresAt<Math.round(Date.now()/1e3)?this.autoRefreshToken&&currentSession.refresh_token?(error=(yield this._callRefreshToken(currentSession.refresh_token))["error"],error&&(console.log(error.message),yield this._removeSession())):this._removeSession():currentSession&&currentSession.user?(this._saveSession(currentSession),this._notifyAllSubscribers("SIGNED_IN")):(console.log("Current session is missing data."),this._removeSession())}catch(err){return console.error(err),null}})}_callRefreshToken(refresh_token){var _a;return void 0===refresh_token&&(refresh_token=null===(_a=this.currentSession)||void 0===_a?void 0:_a.refresh_token),__awaiter(this,void 0,void 0,function*(){try{if(!refresh_token)throw new Error("No current session.");var{data,error}=yield this.api.refreshAccessToken(refresh_token);if(error)throw error;if(!data)throw Error("Invalid session data.");return this._saveSession(data),this._notifyAllSubscribers("SIGNED_IN"),{data:data,error:null}}catch(error){return{data:null,error:error}}})}_notifyAllSubscribers(event){this.stateChangeEmitters.forEach(x=>x.callback(event,this.currentSession))}_saveSession(session){this.currentSession=session,this.currentUser=session.user;var expiresIn=session.expires_at;expiresIn&&(expiresIn=expiresIn-Math.round(Date.now()/1e3),this._startAutoRefreshToken(1e3*(expiresIn-(60<expiresIn?60:.5)))),this.persistSession&&session.expires_at&&this._persistSession(this.currentSession)}_persistSession(data){data={currentSession:data,expiresAt:data.expires_at};helpers_1.isBrowser()&&this.localStorage.setItem(constants_1.STORAGE_KEY,JSON.stringify(data))}_removeSession(){return __awaiter(this,void 0,void 0,function*(){this.currentSession=null,this.currentUser=null,this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),helpers_1.isBrowser()&&(yield this.localStorage.removeItem(constants_1.STORAGE_KEY))})}_startAutoRefreshToken(value){this.refreshTokenTimer&&clearTimeout(this.refreshTokenTimer),value<=0||!this.autoRefreshToken||(this.refreshTokenTimer=setTimeout(()=>this._callRefreshToken(),value),"function"==typeof this.refreshTokenTimer.unref&&this.refreshTokenTimer.unref())}}},{"./GoTrueApi":1,"./lib/constants":4,"./lib/helpers":7,"./lib/polyfills":8}],3:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)},GoTrueClient_1=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.GoTrueClient=exports.GoTrueApi=void 0;var GoTrueApi_1=GoTrueClient_1(require("./GoTrueApi"));exports.GoTrueApi=GoTrueApi_1.default;GoTrueClient_1=GoTrueClient_1(require("./GoTrueClient"));exports.GoTrueClient=GoTrueClient_1.default,__exportStar(require("./lib/types"),exports)},{"./GoTrueApi":1,"./GoTrueClient":2,"./lib/types":9}],4:[function(version_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.COOKIE_OPTIONS=exports.STORAGE_KEY=exports.EXPIRY_MARGIN=exports.DEFAULT_HEADERS=exports.AUDIENCE=exports.GOTRUE_URL=void 0;version_1=version_1("./version");exports.GOTRUE_URL="http://localhost:9999",exports.AUDIENCE="",exports.DEFAULT_HEADERS={"X-Client-Info":`gotrue-js/${version_1.version}`},exports.EXPIRY_MARGIN=6e4,exports.STORAGE_KEY="supabase.auth.token",exports.COOKIE_OPTIONS={name:"sb:token",lifetime:28800,domain:"",path:"/",sameSite:"lax"}},{"./version":10}],5:[function(require,module,exports){"use strict";function serializeCookie(_c,_b){return function(name,maxAge,options){const opt=options||{},enc=encodeURIComponent,fieldContentRegExp=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;if("function"!=typeof enc)throw new TypeError("option encode is invalid");if(!fieldContentRegExp.test(name))throw new TypeError("argument name is invalid");if((maxAge=enc(maxAge))&&!fieldContentRegExp.test(maxAge))throw new TypeError("argument val is invalid");let str=name+"="+maxAge;if(null!=opt.maxAge){maxAge=+opt.maxAge;if(isNaN(maxAge)||!isFinite(maxAge))throw new TypeError("option maxAge is invalid");str+="; Max-Age="+Math.floor(maxAge)}if(opt.domain){if(!fieldContentRegExp.test(opt.domain))throw new TypeError("option domain is invalid");str+="; Domain="+opt.domain}if(opt.path){if(!fieldContentRegExp.test(opt.path))throw new TypeError("option path is invalid");str+="; Path="+opt.path}if(opt.expires){if("function"!=typeof opt.expires.toUTCString)throw new TypeError("option expires is invalid");str+="; Expires="+opt.expires.toUTCString()}if(opt.httpOnly&&(str+="; HttpOnly"),opt.secure&&(str+="; Secure"),opt.sameSite)switch("string"==typeof opt.sameSite?opt.sameSite.toLowerCase():opt.sameSite){case"lax":str+="; SameSite=Lax";break;case"strict":str+="; SameSite=Strict";break;case"none":str+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return str}(_c.name,_c.value,{maxAge:_c.maxAge,expires:new Date(Date.now()+1e3*_c.maxAge),httpOnly:!0,secure:_b,path:null!==(_b=_c.path)&&void 0!==_b?_b:"/",domain:null!==(_b=_c.domain)&&void 0!==_b?_b:"",sameSite:null!==(_c=_c.sameSite)&&void 0!==_c?_c:"lax"})}function setCookies(req,res,previousCookies){const strCookies=previousCookies.map(c=>serializeCookie(c,function(req){if(!req||!req.headers||!req.headers.host)throw new Error('The "host" request header is not available');const host=-1<req.headers.host.indexOf(":")&&req.headers.host.split(":")[0]||req.headers.host;return!(-1<["localhost","127.0.0.1"].indexOf(host)||host.endsWith(".local"))}(req)));previousCookies=res.getHeader("Set-Cookie");previousCookies&&(previousCookies instanceof Array?Array.prototype.push.apply(strCookies,previousCookies):"string"==typeof previousCookies&&strCookies.push(previousCookies)),res.setHeader("Set-Cookie",strCookies)}function setCookie(req,res,cookie){setCookies(req,res,[cookie])}Object.defineProperty(exports,"__esModule",{value:!0}),exports.deleteCookie=exports.setCookie=exports.setCookies=void 0,exports.setCookies=setCookies,exports.setCookie=setCookie,exports.deleteCookie=function(req,res,name){setCookie(req,res,{name:name,value:"",maxAge:-1})}},{}],6:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove=exports.put=exports.post=exports.get=void 0;const cross_fetch_1=__importDefault(require("cross-fetch")),_getErrorMessage=err=>err.msg||err.message||err.error_description||err.error||JSON.stringify(err),handleError=(error,reject)=>{if("function"!=typeof error.json)return reject(error);error.json().then(err=>reject({message:_getErrorMessage(err),status:(null==error?void 0:error.status)||500}))},_getRequestParams=(method,options,body)=>{const params={method:method,headers:(null==options?void 0:options.headers)||{}};return"GET"===method||(params.headers=Object.assign({"Content-Type":"text/plain;charset=UTF-8"},null==options?void 0:options.headers),params.body=JSON.stringify(body)),params};function _handleRequest(method,url,options,body){return __awaiter(this,void 0,void 0,function*(){return new Promise((resolve,reject)=>{cross_fetch_1.default(url,_getRequestParams(method,options,body)).then(result=>{if(!result.ok)throw result;return null!=options&&options.noResolveJson?resolve:result.json()}).then(data=>resolve(data)).catch(error=>handleError(error,reject))})})}exports.get=function(url,options){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("GET",url,options)})},exports.post=function(url,body,options){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("POST",url,options,body)})},exports.put=function(url,body,options){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("PUT",url,options,body)})},exports.remove=function(url,body,options){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("DELETE",url,options,body)})}},{"cross-fetch":46}],7:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getParameterByName=exports.isBrowser=exports.uuid=exports.expiresAt=void 0,exports.expiresAt=function(expiresIn){return Math.round(Date.now()/1e3)+expiresIn},exports.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},exports.isBrowser=()=>"undefined"!=typeof window,exports.getParameterByName=function(name,results){return results=results||window.location.href,name=name.replace(/[\[\]]/g,"\\$&"),(results=new RegExp("[?&#]"+name+"(=([^&#]*)|&|#|$)").exec(results))?results[2]?decodeURIComponent(results[2].replace(/\+/g," ")):"":null}},{}],8:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.polyfillGlobalThis=void 0,exports.polyfillGlobalThis=function(){if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"undefined"!=typeof self&&(self.globalThis=self)}}},{}],9:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0})},{}],10:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.version=void 0,exports.version="1.18.0"},{}],11:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const PostgrestQueryBuilder_1=__importDefault(require("./lib/PostgrestQueryBuilder")),PostgrestRpcBuilder_1=__importDefault(require("./lib/PostgrestRpcBuilder")),constants_1=require("./lib/constants");exports.default=class{constructor(url,{headers={},schema}={}){this.url=url,this.headers=Object.assign(Object.assign({},constants_1.DEFAULT_HEADERS),headers),this.schema=schema}auth(token){return this.headers.Authorization=`Bearer ${token}`,this}from(url){url=`${this.url}/${url}`;return new PostgrestQueryBuilder_1.default(url,{headers:this.headers,schema:this.schema})}rpc(url,params,{head=!1,count=null}={}){url=`${this.url}/rpc/${url}`;return new PostgrestRpcBuilder_1.default(url,{headers:this.headers,schema:this.schema}).rpc(params,{head:head,count:count})}}},{"./lib/PostgrestQueryBuilder":14,"./lib/PostgrestRpcBuilder":15,"./lib/constants":17}],12:[function(require,module,exports){"use strict";var PostgrestQueryBuilder_1=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PostgrestFilterBuilder=exports.PostgrestQueryBuilder=exports.PostgrestBuilder=exports.PostgrestClient=void 0;var PostgrestFilterBuilder_1=PostgrestQueryBuilder_1(require("./PostgrestClient"));exports.PostgrestClient=PostgrestFilterBuilder_1.default;PostgrestFilterBuilder_1=PostgrestQueryBuilder_1(require("./lib/PostgrestFilterBuilder"));exports.PostgrestFilterBuilder=PostgrestFilterBuilder_1.default;PostgrestQueryBuilder_1=PostgrestQueryBuilder_1(require("./lib/PostgrestQueryBuilder"));exports.PostgrestQueryBuilder=PostgrestQueryBuilder_1.default;const types_1=require("./lib/types");Object.defineProperty(exports,"PostgrestBuilder",{enumerable:!0,get:function(){return types_1.PostgrestBuilder}})},{"./PostgrestClient":11,"./lib/PostgrestFilterBuilder":13,"./lib/PostgrestQueryBuilder":14,"./lib/types":18}],13:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});class PostgrestFilterBuilder extends __importDefault(require("./PostgrestTransformBuilder")).default{constructor(){super(...arguments),this.cs=this.contains,this.cd=this.containedBy,this.sl=this.rangeLt,this.sr=this.rangeGt,this.nxl=this.rangeGte,this.nxr=this.rangeLte,this.adj=this.rangeAdjacent,this.ov=this.overlaps}not(column,operator,value){return this.url.searchParams.append(`${column}`,`not.${operator}.${value}`),this}or(filters,{foreignTable}={}){return this.url.searchParams.append(void 0===foreignTable?"or":`${foreignTable}.or`,`(${filters})`),this}eq(column,value){return this.url.searchParams.append(`${column}`,`eq.${value}`),this}neq(column,value){return this.url.searchParams.append(`${column}`,`neq.${value}`),this}gt(column,value){return this.url.searchParams.append(`${column}`,`gt.${value}`),this}gte(column,value){return this.url.searchParams.append(`${column}`,`gte.${value}`),this}lt(column,value){return this.url.searchParams.append(`${column}`,`lt.${value}`),this}lte(column,value){return this.url.searchParams.append(`${column}`,`lte.${value}`),this}like(column,pattern){return this.url.searchParams.append(`${column}`,`like.${pattern}`),this}ilike(column,pattern){return this.url.searchParams.append(`${column}`,`ilike.${pattern}`),this}is(column,value){return this.url.searchParams.append(`${column}`,`is.${value}`),this}in(column,cleanedValues){cleanedValues=cleanedValues.map(s=>"string"==typeof s&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(`${column}`,`in.(${cleanedValues})`),this}contains(column,value){return"string"==typeof value?this.url.searchParams.append(`${column}`,`cs.${value}`):Array.isArray(value)?this.url.searchParams.append(`${column}`,`cs.{${value.join(",")}}`):this.url.searchParams.append(`${column}`,`cs.${JSON.stringify(value)}`),this}containedBy(column,value){return"string"==typeof value?this.url.searchParams.append(`${column}`,`cd.${value}`):Array.isArray(value)?this.url.searchParams.append(`${column}`,`cd.{${value.join(",")}}`):this.url.searchParams.append(`${column}`,`cd.${JSON.stringify(value)}`),this}rangeLt(column,range){return this.url.searchParams.append(`${column}`,`sl.${range}`),this}rangeGt(column,range){return this.url.searchParams.append(`${column}`,`sr.${range}`),this}rangeGte(column,range){return this.url.searchParams.append(`${column}`,`nxl.${range}`),this}rangeLte(column,range){return this.url.searchParams.append(`${column}`,`nxr.${range}`),this}rangeAdjacent(column,range){return this.url.searchParams.append(`${column}`,`adj.${range}`),this}overlaps(column,value){return"string"==typeof value?this.url.searchParams.append(`${column}`,`ov.${value}`):this.url.searchParams.append(`${column}`,`ov.{${value.join(",")}}`),this}textSearch(column,query,{config,type=null}={}){let typePart="";return"plain"===type?typePart="pl":"phrase"===type?typePart="ph":"websearch"===type&&(typePart="w"),this.url.searchParams.append(`${column}`,`${typePart}fts${void 0===config?"":`(${config})`}.${query}`),this}fts(column,query,{config}={}){return this.url.searchParams.append(`${column}`,`fts${void 0===config?"":`(${config})`}.${query}`),this}plfts(column,query,{config}={}){return this.url.searchParams.append(`${column}`,`plfts${void 0===config?"":`(${config})`}.${query}`),this}phfts(column,query,{config}={}){return this.url.searchParams.append(`${column}`,`phfts${void 0===config?"":`(${config})`}.${query}`),this}wfts(column,query,{config}={}){return this.url.searchParams.append(`${column}`,`wfts${void 0===config?"":`(${config})`}.${query}`),this}filter(column,operator,value){return this.url.searchParams.append(`${column}`,`${operator}.${value}`),this}match(query){return Object.keys(query).forEach(key=>{this.url.searchParams.append(`${key}`,`eq.${query[key]}`)}),this}}exports.default=PostgrestFilterBuilder},{"./PostgrestTransformBuilder":16}],14:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var types_1=require("./types");const PostgrestFilterBuilder_1=__importDefault(require("./PostgrestFilterBuilder"));class PostgrestQueryBuilder extends types_1.PostgrestBuilder{constructor(url,{headers={},schema}={}){super({}),this.url=new URL(url),this.headers=Object.assign({},headers),this.schema=schema}select(cleanedColumns="*",{head=!1,count=null}={}){let quoted=!(this.method="GET");cleanedColumns=cleanedColumns.split("").map(c=>/\s/.test(c)&&!quoted?"":('"'===c&&(quoted=!quoted),c)).join("");return this.url.searchParams.set("select",cleanedColumns),count&&(this.headers.Prefer=`count=${count}`),head&&(this.method="HEAD"),new PostgrestFilterBuilder_1.default(this)}insert(columns,{upsert=!1,onConflict,returning="representation",count=null}={}){this.method="POST";const prefersHeaders=[`return=${returning}`];if(upsert&&prefersHeaders.push("resolution=merge-duplicates"),upsert&&void 0!==onConflict&&this.url.searchParams.set("on_conflict",onConflict),this.body=columns,count&&prefersHeaders.push(`count=${count}`),this.headers.Prefer=prefersHeaders.join(","),Array.isArray(columns)){columns=columns.reduce((acc,x)=>acc.concat(Object.keys(x)),[]);if(0<columns.length){const uniqueColumns=[...new Set(columns)].map(column=>`"${column}"`);this.url.searchParams.set("columns",uniqueColumns.join(","))}}return new PostgrestFilterBuilder_1.default(this)}upsert(values,{onConflict,returning="representation",count=null,ignoreDuplicates=!1}={}){this.method="POST";const prefersHeaders=[`resolution=${ignoreDuplicates?"ignore":"merge"}-duplicates`,`return=${returning}`];return void 0!==onConflict&&this.url.searchParams.set("on_conflict",onConflict),this.body=values,count&&prefersHeaders.push(`count=${count}`),this.headers.Prefer=prefersHeaders.join(","),new PostgrestFilterBuilder_1.default(this)}update(values,{returning="representation",count=null}={}){this.method="PATCH";const prefersHeaders=[`return=${returning}`];return this.body=values,count&&prefersHeaders.push(`count=${count}`),this.headers.Prefer=prefersHeaders.join(","),new PostgrestFilterBuilder_1.default(this)}delete({returning="representation",count=null}={}){this.method="DELETE";const prefersHeaders=[`return=${returning}`];return count&&prefersHeaders.push(`count=${count}`),this.headers.Prefer=prefersHeaders.join(","),new PostgrestFilterBuilder_1.default(this)}}exports.default=PostgrestQueryBuilder},{"./PostgrestFilterBuilder":13,"./types":18}],15:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var types_1=require("./types");const PostgrestFilterBuilder_1=__importDefault(require("./PostgrestFilterBuilder"));class PostgrestRpcBuilder extends types_1.PostgrestBuilder{constructor(url,{headers={},schema}={}){super({}),this.url=new URL(url),this.headers=Object.assign({},headers),this.schema=schema}rpc(params,{head=!1,count=null}={}){return head?(this.method="HEAD",params&&Object.entries(params).forEach(([name,value])=>{this.url.searchParams.append(name,value)})):(this.method="POST",this.body=params),count&&(void 0!==this.headers.Prefer?this.headers.Prefer+=`,count=${count}`:this.headers.Prefer=`count=${count}`),new PostgrestFilterBuilder_1.default(this)}}exports.default=PostgrestRpcBuilder},{"./PostgrestFilterBuilder":13,"./types":18}],16:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class PostgrestTransformBuilder extends require("./types").PostgrestBuilder{select(cleanedColumns="*"){let quoted=!1;cleanedColumns=cleanedColumns.split("").map(c=>/\s/.test(c)&&!quoted?"":('"'===c&&(quoted=!quoted),c)).join("");return this.url.searchParams.set("select",cleanedColumns),this}order(column,{ascending=!0,nullsFirst=!1,foreignTable:existingOrder}={}){var key=void 0===existingOrder?"order":`${existingOrder}.order`,existingOrder=this.url.searchParams.get(key);return this.url.searchParams.set(key,`${existingOrder?`${existingOrder},`:""}${column}.${ascending?"asc":"desc"}.${nullsFirst?"nullsfirst":"nullslast"}`),this}limit(count,{foreignTable}={}){return this.url.searchParams.set(void 0===foreignTable?"limit":`${foreignTable}.limit`,`${count}`),this}range(from,to,{foreignTable}={}){var keyLimit=void 0===foreignTable?"limit":`${foreignTable}.limit`;return this.url.searchParams.set(void 0===foreignTable?"offset":`${foreignTable}.offset`,`${from}`),this.url.searchParams.set(keyLimit,`${to-from+1}`),this}abortSignal(signal){return this.signal=signal,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){this.headers.Accept="application/vnd.pgrst.object+json";const _this=new PostgrestTransformBuilder(this);return _this.then=(onfulfilled,onrejected)=>this.then(res=>{var _b;return null!==(_b=null===(_b=res.error)||void 0===_b?void 0:_b.details)&&void 0!==_b&&_b.includes("Results contain 0 rows")?onfulfilled({error:null,data:null,count:res.count,status:200,statusText:"OK",body:null}):onfulfilled(res)},onrejected),_this}csv(){return this.headers.Accept="text/csv",this}}exports.default=PostgrestTransformBuilder},{"./types":18}],17:[function(version_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_HEADERS=void 0;version_1=version_1("./version");exports.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${version_1.version}`}},{"./version":19}],18:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.PostgrestBuilder=void 0;const cross_fetch_1=__importDefault(require("cross-fetch"));exports.PostgrestBuilder=class{constructor(builder){this.shouldThrowOnError=!1,Object.assign(this,builder)}throwOnError(){return this.shouldThrowOnError=!0,this}then(onfulfilled,onrejected){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let res=cross_fetch_1.default(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(res=>__awaiter(this,void 0,void 0,function*(){let error=null,data=null,count=null;if(res.ok){var contentRange=null===(contentRange=this.headers.Prefer)||void 0===contentRange?void 0:contentRange.split(",").includes("return=minimal");"HEAD"===this.method||contentRange||(countHeader=yield res.text())&&(data="text/csv"===this.headers.Accept?countHeader:JSON.parse(countHeader));var countHeader=null===(contentRange=this.headers.Prefer)||void 0===contentRange?void 0:contentRange.match(/count=(exact|planned|estimated)/),contentRange=null===(contentRange=res.headers.get("content-range"))||void 0===contentRange?void 0:contentRange.split("/");countHeader&&contentRange&&1<contentRange.length&&(count=parseInt(contentRange[1]))}else if(error=yield res.json(),error&&this.shouldThrowOnError)throw error;return{error:error,data:data,count:count,status:res.status,statusText:res.statusText,body:data}}));return this.shouldThrowOnError||(res=res.catch(fetchError=>({error:{message:`FetchError: ${fetchError.message}`,details:"",hint:"",code:fetchError.code||""},data:null,body:null,count:null,status:400,statusText:"Bad Request"}))),res.then(onfulfilled,onrejected)}}},{"cross-fetch":46}],19:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.version=void 0,exports.version="0.34.1"},{}],20:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=require("./lib/constants"),timer_1=__importDefault(require("./lib/timer")),RealtimeSubscription_1=__importDefault(require("./RealtimeSubscription")),websocket_1=require("websocket"),serializer_1=__importDefault(require("./lib/serializer")),noop=()=>{};exports.default=class{constructor(endPoint,options){this.channels=[],this.endPoint="",this.headers=constants_1.DEFAULT_HEADERS,this.params={},this.timeout=constants_1.DEFAULT_TIMEOUT,this.transport=websocket_1.w3cwebsocket,this.heartbeatIntervalMs=3e4,this.longpollerTimeout=2e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=noop,this.conn=null,this.sendBuffer=[],this.serializer=new serializer_1.default,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.endPoint=`${endPoint}/${constants_1.TRANSPORTS.websocket}`,null!=options&&options.params&&(this.params=options.params),null!=options&&options.headers&&(this.headers=Object.assign(Object.assign({},this.headers),options.headers)),null!=options&&options.timeout&&(this.timeout=options.timeout),null!=options&&options.logger&&(this.logger=options.logger),null!=options&&options.transport&&(this.transport=options.transport),null!=options&&options.heartbeatIntervalMs&&(this.heartbeatIntervalMs=options.heartbeatIntervalMs),null!=options&&options.longpollerTimeout&&(this.longpollerTimeout=options.longpollerTimeout),this.reconnectAfterMs=null!=options&&options.reconnectAfterMs?options.reconnectAfterMs:tries=>[1e3,2e3,5e3,1e4][tries-1]||1e4,this.encode=null!=options&&options.encode?options.encode:(payload,callback)=>callback(JSON.stringify(payload)),this.decode=null!=options&&options.decode?options.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new timer_1.default(()=>__awaiter(this,void 0,void 0,function*(){yield this.disconnect(),this.connect()}),this.reconnectAfterMs)}connect(){this.conn||(this.conn=new this.transport(this.endPointURL(),[],null,this.headers),this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=error=>this._onConnError(error),this.conn.onmessage=event=>this.onConnMessage(event),this.conn.onclose=event=>this._onConnClose(event)))}disconnect(code,reason){return new Promise((resolve,_reject)=>{try{this.conn&&(this.conn.onclose=function(){},code?this.conn.close(code,reason||""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset()),resolve({error:null,data:!0})}catch(error){resolve({error:error,data:!1})}})}log(kind,msg,data){this.logger(kind,msg,data)}onOpen(callback){this.stateChangeCallbacks.open.push(callback)}onClose(callback){this.stateChangeCallbacks.close.push(callback)}onError(callback){this.stateChangeCallbacks.error.push(callback)}onMessage(callback){this.stateChangeCallbacks.message.push(callback)}connectionState(){switch(this.conn&&this.conn.readyState){case constants_1.SOCKET_STATES.connecting:return"connecting";case constants_1.SOCKET_STATES.open:return"open";case constants_1.SOCKET_STATES.closing:return"closing";default:return"closed"}}isConnected(){return"open"===this.connectionState()}remove(channel){this.channels=this.channels.filter(c=>c.joinRef()!==channel.joinRef())}channel(topic,chan={}){chan=new RealtimeSubscription_1.default(topic,chan,this);return this.channels.push(chan),chan}push(data){var{topic,event,payload,ref}=data,callback=()=>{this.encode(data,result=>{var _a;null!==(_a=this.conn)&&void 0!==_a&&_a.send(result)})};this.log("push",`${topic} ${event} (${ref})`,payload),this.isConnected()?callback():this.sendBuffer.push(callback)}onConnMessage(rawMessage){this.decode(rawMessage.data,msg=>{let{topic,event,payload,ref}=msg;ref&&ref===this.pendingHeartbeatRef?this.pendingHeartbeatRef=null:event===(null===payload||void 0===payload?void 0:payload.type)&&this._resetHeartbeat(),this.log("receive",`${payload.status||""} ${topic} ${event} ${ref&&"("+ref+")"||""}`,payload),this.channels.filter(channel=>channel.isMember(topic)).forEach(channel=>channel.trigger(event,payload,ref)),this.stateChangeCallbacks.message.forEach(callback=>callback(msg))})}endPointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:constants_1.VSN}))}makeRef(){var newRef=this.ref+1;return newRef===this.ref?this.ref=0:this.ref=newRef,this.ref.toString()}_onConnOpen(){this.log("transport",`connected to ${this.endPointURL()}`),this._flushSendBuffer(),this.reconnectTimer.reset(),this._resetHeartbeat(),this.stateChangeCallbacks.open.forEach(callback=>callback())}_onConnClose(event){this.log("transport","close",event),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(callback=>callback(event))}_onConnError(error){this.log("transport",error.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(callback=>callback(error))}_triggerChanError(){this.channels.forEach(channel=>channel.trigger(constants_1.CHANNEL_EVENTS.error))}_appendParams(url,params){if(0===Object.keys(params).length)return url;var prefix=url.match(/\?/)?"&":"?";return`${url}${prefix}${new URLSearchParams(params)}`}_flushSendBuffer(){this.isConnected()&&0<this.sendBuffer.length&&(this.sendBuffer.forEach(callback=>callback()),this.sendBuffer=[])}_resetHeartbeat(){this.pendingHeartbeatRef=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this._sendHeartbeat(),this.heartbeatIntervalMs)}_sendHeartbeat(){var _a;if(this.isConnected()){if(this.pendingHeartbeatRef)return this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),void(null!==(_a=this.conn)&&void 0!==_a&&_a.close(constants_1.WS_CLOSE_NORMAL,"hearbeat timeout"));this.pendingHeartbeatRef=this.makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef})}}}},{"./RealtimeSubscription":21,"./lib/constants":23,"./lib/serializer":25,"./lib/timer":26,websocket:48}],21:[function(require,module,exports){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=require("./lib/constants"),push_1=__importDefault(require("./lib/push")),timer_1=__importDefault(require("./lib/timer"));exports.default=class{constructor(topic,params={},socket){this.topic=topic,this.params=params,this.socket=socket,this.bindings=[],this.state=constants_1.CHANNEL_STATES.closed,this.joinedOnce=!1,this.pushBuffer=[],this.timeout=this.socket.timeout,this.joinPush=new push_1.default(this,constants_1.CHANNEL_EVENTS.join,this.params,this.timeout),this.rejoinTimer=new timer_1.default(()=>this.rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=constants_1.CHANNEL_STATES.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(pushEvent=>pushEvent.send()),this.pushBuffer=[]}),this.onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this.joinRef()}`),this.state=constants_1.CHANNEL_STATES.closed,this.socket.remove(this)}),this.onError(reason=>{this.isLeaving()||this.isClosed()||(this.socket.log("channel",`error ${this.topic}`,reason),this.state=constants_1.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this.isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=constants_1.CHANNEL_STATES.errored,this.rejoinTimer.scheduleTimeout())}),this.on(constants_1.CHANNEL_EVENTS.reply,(payload,ref)=>{this.trigger(this.replyEventName(ref),payload)})}rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this.rejoin()}subscribe(timeout=this.timeout){if(this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";return this.joinedOnce=!0,this.rejoin(timeout),this.joinPush}onClose(callback){this.on(constants_1.CHANNEL_EVENTS.close,callback)}onError(callback){this.on(constants_1.CHANNEL_EVENTS.error,reason=>callback(reason))}on(event,callback){this.bindings.push({event:event,callback:callback})}off(event){this.bindings=this.bindings.filter(bind=>bind.event!==event)}canPush(){return this.socket.isConnected()&&this.isJoined()}push(event,payload,timeout=this.timeout){if(!this.joinedOnce)throw`tried to push '${event}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let pushEvent=new push_1.default(this,event,payload,timeout);return this.canPush()?pushEvent.send():(pushEvent.startTimeout(),this.pushBuffer.push(pushEvent)),pushEvent}unsubscribe(timeout=this.timeout){this.state=constants_1.CHANNEL_STATES.leaving;let onClose=()=>{this.socket.log("channel",`leave ${this.topic}`),this.trigger(constants_1.CHANNEL_EVENTS.close,"leave",this.joinRef())};this.joinPush.destroy();let leavePush=new push_1.default(this,constants_1.CHANNEL_EVENTS.leave,{},timeout);return leavePush.receive("ok",()=>onClose()).receive("timeout",()=>onClose()),leavePush.send(),this.canPush()||leavePush.trigger("ok",{}),leavePush}onMessage(event,payload,ref){return payload}isMember(topic){return this.topic===topic}joinRef(){return this.joinPush.ref}sendJoin(timeout){this.state=constants_1.CHANNEL_STATES.joining,this.joinPush.resend(timeout)}rejoin(timeout=this.timeout){this.isLeaving()||this.sendJoin(timeout)}trigger(event,payload,ref){var{close,error,leave,join}=constants_1.CHANNEL_EVENTS;let events=[close,error,leave,join];if(!(ref&&0<=events.indexOf(event)&&ref!==this.joinRef())){let handledPayload=this.onMessage(event,payload,ref);if(payload&&!handledPayload)throw"channel onMessage callbacks must return the payload, modified or unmodified";this.bindings.filter(bind=>"*"===bind.event?event===(null==payload?void 0:payload.type):bind.event===event).map(bind=>bind.callback(handledPayload,ref))}}replyEventName(ref){return`chan_reply_${ref}`}isClosed(){return this.state===constants_1.CHANNEL_STATES.closed}isErrored(){return this.state===constants_1.CHANNEL_STATES.errored}isJoined(){return this.state===constants_1.CHANNEL_STATES.joined}isJoining(){return this.state===constants_1.CHANNEL_STATES.joining}isLeaving(){return this.state===constants_1.CHANNEL_STATES.leaving}}},{"./lib/constants":23,"./lib/push":24,"./lib/timer":26}],22:[function(RealtimeSubscription_1,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__setModuleDefault=this&&this.__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v}),RealtimeClient_1=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)"default"!==k&&Object.prototype.hasOwnProperty.call(mod,k)&&__createBinding(result,mod,k);return __setModuleDefault(result,mod),result},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Transformers=exports.RealtimeSubscription=exports.RealtimeClient=void 0;RealtimeClient_1=RealtimeClient_1(RealtimeSubscription_1("./lib/transformers"));exports.Transformers=RealtimeClient_1;RealtimeClient_1=__importDefault(RealtimeSubscription_1("./RealtimeClient"));exports.RealtimeClient=RealtimeClient_1.default;RealtimeSubscription_1=__importDefault(RealtimeSubscription_1("./RealtimeSubscription"));exports.RealtimeSubscription=RealtimeSubscription_1.default},{"./RealtimeClient":20,"./RealtimeSubscription":21,"./lib/transformers":27}],23:[function(version_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.TRANSPORTS=exports.CHANNEL_EVENTS=exports.CHANNEL_STATES=exports.SOCKET_STATES=exports.WS_CLOSE_NORMAL=exports.DEFAULT_TIMEOUT=exports.VSN=exports.DEFAULT_HEADERS=void 0;version_1=version_1("./version");exports.DEFAULT_HEADERS={"X-Client-Info":`realtime-js/${version_1.version}`},exports.VSN="1.0.0",exports.DEFAULT_TIMEOUT=1e4,exports.WS_CLOSE_NORMAL=1e3,function(SOCKET_STATES){SOCKET_STATES[SOCKET_STATES.connecting=0]="connecting",SOCKET_STATES[SOCKET_STATES.open=1]="open",SOCKET_STATES[SOCKET_STATES.closing=2]="closing",SOCKET_STATES[SOCKET_STATES.closed=3]="closed"}(exports.SOCKET_STATES||(exports.SOCKET_STATES={})),function(CHANNEL_STATES){CHANNEL_STATES.closed="closed",CHANNEL_STATES.errored="errored",CHANNEL_STATES.joined="joined",CHANNEL_STATES.joining="joining",CHANNEL_STATES.leaving="leaving"}(exports.CHANNEL_STATES||(exports.CHANNEL_STATES={})),function(CHANNEL_EVENTS){CHANNEL_EVENTS.close="phx_close",CHANNEL_EVENTS.error="phx_error",CHANNEL_EVENTS.join="phx_join",CHANNEL_EVENTS.reply="phx_reply",CHANNEL_EVENTS.leave="phx_leave"}(exports.CHANNEL_EVENTS||(exports.CHANNEL_EVENTS={})),(exports.TRANSPORTS||(exports.TRANSPORTS={})).websocket="websocket"},{"./version":28}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=require("../lib/constants");exports.default=class{constructor(channel,event,payload={},timeout=constants_1.DEFAULT_TIMEOUT){this.channel=channel,this.event=event,this.payload=payload,this.timeout=timeout,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(timeout){this.timeout=timeout,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref}))}receive(status,callback){var _a;return this._hasReceived(status)&&callback(null===(_a=this.receivedResp)||void 0===_a?void 0:_a.response),this.recHooks.push({status:status,callback:callback}),this}startTimeout(){this.timeoutTimer||(this.ref=this.channel.socket.makeRef(),this.refEvent=this.channel.replyEventName(this.ref),this.channel.on(this.refEvent,payload=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=payload,this._matchReceive(payload)}),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout))}trigger(status,response){this.refEvent&&this.channel.trigger(this.refEvent,{status:status,response:response})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel.off(this.refEvent)}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status,response}){this.recHooks.filter(h=>h.status===status).forEach(h=>h.callback(response))}_hasReceived(status){return this.receivedResp&&this.receivedResp.status===status}}},{"../lib/constants":23}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=class{constructor(){this.HEADER_LENGTH=1}decode(rawPayload,callback){return rawPayload.constructor===ArrayBuffer?callback(this._binaryDecode(rawPayload)):callback("string"==typeof rawPayload?JSON.parse(rawPayload):{})}_binaryDecode(buffer){var view=new DataView(buffer),decoder=new TextDecoder;return this._decodeBroadcast(buffer,view,decoder)}_decodeBroadcast(buffer,topic,decoder){var event=topic.getUint8(1),eventSize=topic.getUint8(2),offset=this.HEADER_LENGTH+2,topic=decoder.decode(buffer.slice(offset,offset+event)),event=decoder.decode(buffer.slice(offset+=event,offset+eventSize));return offset+=eventSize,{ref:null,topic:topic,event:event,payload:JSON.parse(decoder.decode(buffer.slice(offset,buffer.byteLength)))}}}},{}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=class{constructor(callback,timerCalc){this.callback=callback,this.timerCalc=timerCalc,this.timer=void 0,this.tries=0,this.callback=callback,this.timerCalc=timerCalc}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}},{}],27:[function(require,module,exports){"use strict";var PostgresTypes;Object.defineProperty(exports,"__esModule",{value:!0}),exports.toTimestampString=exports.toArray=exports.toJson=exports.toIntRange=exports.toInt=exports.toFloat=exports.toDateRange=exports.toDate=exports.toBoolean=exports.convertCell=exports.convertColumn=exports.convertChangeData=exports.PostgresTypes=void 0,function(PostgresTypes){PostgresTypes.abstime="abstime",PostgresTypes.bool="bool",PostgresTypes.date="date",PostgresTypes.daterange="daterange",PostgresTypes.float4="float4",PostgresTypes.float8="float8",PostgresTypes.int2="int2",PostgresTypes.int4="int4",PostgresTypes.int4range="int4range",PostgresTypes.int8="int8",PostgresTypes.int8range="int8range",PostgresTypes.json="json",PostgresTypes.jsonb="jsonb",PostgresTypes.money="money",PostgresTypes.numeric="numeric",PostgresTypes.oid="oid",PostgresTypes.reltime="reltime",PostgresTypes.time="time",PostgresTypes.timestamp="timestamp",PostgresTypes.timestamptz="timestamptz",PostgresTypes.timetz="timetz",PostgresTypes.tsrange="tsrange",PostgresTypes.tstzrange="tstzrange"}(PostgresTypes=exports.PostgresTypes||(exports.PostgresTypes={})),exports.convertChangeData=(columns,records,options={})=>{let result={},skipTypes=void 0!==options.skipTypes?options.skipTypes:[];return Object.entries(records).map(([key])=>{result[key]=exports.convertColumn(key,columns,records,skipTypes)}),result},exports.convertColumn=(columnName,column,records,skipTypes)=>{column=column.find(x=>x.name==columnName);return!column||skipTypes.includes(column.type)?noop(records[columnName]):exports.convertCell(column.type,records[columnName])},exports.convertCell=(type,stringValue)=>{try{if(null===stringValue)return null;if("_"===type.charAt(0)){var arrayValue=type.slice(1,type.length);return exports.toArray(stringValue,arrayValue)}switch(type){case PostgresTypes.abstime:return noop(stringValue);case PostgresTypes.bool:return exports.toBoolean(stringValue);case PostgresTypes.date:return noop(stringValue);case PostgresTypes.daterange:return exports.toDateRange(stringValue);case PostgresTypes.float4:case PostgresTypes.float8:return exports.toFloat(stringValue);case PostgresTypes.int2:case PostgresTypes.int4:return exports.toInt(stringValue);case PostgresTypes.int4range:return exports.toIntRange(stringValue);case PostgresTypes.int8:return exports.toInt(stringValue);case PostgresTypes.int8range:return exports.toIntRange(stringValue);case PostgresTypes.json:case PostgresTypes.jsonb:return exports.toJson(stringValue);case PostgresTypes.money:case PostgresTypes.numeric:return exports.toFloat(stringValue);case PostgresTypes.oid:return exports.toInt(stringValue);case PostgresTypes.reltime:case PostgresTypes.time:return noop(stringValue);case PostgresTypes.timestamp:return exports.toTimestampString(stringValue);case PostgresTypes.timestamptz:case PostgresTypes.timetz:return noop(stringValue);case PostgresTypes.tsrange:case PostgresTypes.tstzrange:return exports.toDateRange(stringValue);default:return noop(stringValue)}}catch(error){return console.log(`Could not convert cell of type ${type} and value ${stringValue}`),console.log(`This is the error: ${error}`),stringValue}};const noop=stringValue=>stringValue;exports.toBoolean=stringValue=>{switch(stringValue){case"t":return!0;case"f":return!1;default:return null}},exports.toDate=stringValue=>new Date(stringValue),exports.toDateRange=arr=>{arr=JSON.parse(arr);return[new Date(arr[0]),new Date(arr[1])]},exports.toFloat=stringValue=>parseFloat(stringValue),exports.toInt=stringValue=>parseInt(stringValue),exports.toIntRange=arr=>{arr=JSON.parse(arr);return[parseInt(arr[0]),parseInt(arr[1])]},exports.toJson=stringValue=>JSON.parse(stringValue),exports.toArray=(stringValue,type)=>{let stringEnriched=stringValue.slice(1,stringValue.length-1),stringArray=0<stringEnriched.length?stringEnriched.split(","):[];return stringArray.map(string=>exports.convertCell(type,string))},exports.toTimestampString=stringValue=>stringValue.replace(" ","T")},{}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.version=void 0,exports.version="1.1.3"},{}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SupabaseStorageClient=void 0;const lib_1=require("./lib");class SupabaseStorageClient extends lib_1.StorageBucketApi{constructor(url,headers={}){super(url,headers)}from(id){return new lib_1.StorageFileApi(this.url,this.headers,id)}}exports.SupabaseStorageClient=SupabaseStorageClient},{"./lib":35}],30:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SupabaseStorageClient=void 0;const SupabaseStorageClient_1=require("./SupabaseStorageClient");Object.defineProperty(exports,"SupabaseStorageClient",{enumerable:!0,get:function(){return SupabaseStorageClient_1.SupabaseStorageClient}}),__exportStar(require("./lib/types"),exports)},{"./SupabaseStorageClient":29,"./lib/types":36}],31:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.StorageBucketApi=void 0;const fetch_1=require("./fetch"),constants_1=require("./constants");exports.StorageBucketApi=class{constructor(url,headers={}){this.url=url,this.headers=Object.assign(Object.assign({},constants_1.DEFAULT_HEADERS),headers)}listBuckets(){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.get(`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}getBucket(id){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.get(`${this.url}/bucket/${id}`,{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}createBucket(id,options={public:!1}){return __awaiter(this,void 0,void 0,function*(){try{return{data:(yield fetch_1.post(`${this.url}/bucket`,{id:id,name:id,public:options.public},{headers:this.headers})).name,error:null}}catch(error){return{data:null,error:error}}})}updateBucket(id,options){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.put(`${this.url}/bucket/${id}`,{id:id,name:id,public:options.public},{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}emptyBucket(id){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.post(`${this.url}/bucket/${id}/empty`,{},{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}deleteBucket(id){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.remove(`${this.url}/bucket/${id}`,{},{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}}},{"./constants":33,"./fetch":34}],32:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.StorageFileApi=void 0;const fetch_1=require("./fetch"),cross_fetch_1=__importDefault(require("cross-fetch")),DEFAULT_SEARCH_OPTIONS={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},DEFAULT_FILE_OPTIONS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};exports.StorageFileApi=class{constructor(url,headers={},bucketId){this.url=url,this.headers=headers,this.bucketId=bucketId}uploadOrUpdate(method,path,fileBody,fileOptions){return __awaiter(this,void 0,void 0,function*(){try{let body;var options=Object.assign(Object.assign({},DEFAULT_FILE_OPTIONS),fileOptions);const headers=Object.assign(Object.assign({},this.headers),"POST"===method&&{"x-upsert":String(options.upsert)});"undefined"!=typeof Blob&&fileBody instanceof Blob?(body=new FormData,body.append("cacheControl",options.cacheControl),body.append("",fileBody)):"undefined"!=typeof FormData&&fileBody instanceof FormData?(body=fileBody,body.append("cacheControl",options.cacheControl)):(body=fileBody,headers["cache-control"]=`max-age=${options.cacheControl}`,headers["content-type"]=options.contentType);var _path=this._getFinalPath(path);const res=yield cross_fetch_1.default(`${this.url}/object/${_path}`,{method:method,body:body,headers:headers});return res.ok?{data:{Key:_path},error:null}:{data:null,error:yield res.json()}}catch(error){return{data:null,error:error}}})}upload(path,fileBody,fileOptions){return __awaiter(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",path,fileBody,fileOptions)})}update(path,fileBody,fileOptions){return __awaiter(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",path,fileBody,fileOptions)})}move(fromPath,toPath){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.post(`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:fromPath,destinationKey:toPath},{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}createSignedUrl(path,expiresIn){return __awaiter(this,void 0,void 0,function*(){try{var _path=this._getFinalPath(path),data=yield fetch_1.post(`${this.url}/object/sign/${_path}`,{expiresIn:expiresIn},{headers:this.headers}),signedURL=`${this.url}${data.signedURL}`;return{data:data={signedURL:signedURL},error:null,signedURL:signedURL}}catch(error){return{data:null,error:error,signedURL:null}}})}download(path){return __awaiter(this,void 0,void 0,function*(){try{var _path=this._getFinalPath(path);const res=yield fetch_1.get(`${this.url}/object/${_path}`,{headers:this.headers,noResolveJson:!0});return{data:yield res.blob(),error:null}}catch(error){return{data:null,error:error}}})}getPublicUrl(path){try{var _path=this._getFinalPath(path),publicURL=`${this.url}/object/public/${_path}`;return{data:{publicURL:publicURL},error:null,publicURL:publicURL}}catch(error){return{data:null,error:error,publicURL:null}}}remove(paths){return __awaiter(this,void 0,void 0,function*(){try{return{data:yield fetch_1.remove(`${this.url}/object/${this.bucketId}`,{prefixes:paths},{headers:this.headers}),error:null}}catch(error){return{data:null,error:error}}})}list(path,options,parameters){return __awaiter(this,void 0,void 0,function*(){try{var body=Object.assign(Object.assign(Object.assign({},DEFAULT_SEARCH_OPTIONS),options),{prefix:path||""});return{data:yield fetch_1.post(`${this.url}/object/list/${this.bucketId}`,body,{headers:this.headers},parameters),error:null}}catch(error){return{data:null,error:error}}})}_getFinalPath(path){return`${this.bucketId}/${path}`}}},{"./fetch":34,"cross-fetch":46}],33:[function(version_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_HEADERS=void 0;version_1=version_1("./version");exports.DEFAULT_HEADERS={"X-Client-Info":`storage-js/${version_1.version}`}},{"./version":37}],34:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.remove=exports.put=exports.post=exports.get=void 0;const cross_fetch_1=__importDefault(require("cross-fetch")),_getErrorMessage=err=>err.msg||err.message||err.error_description||err.error||JSON.stringify(err),handleError=(error,reject)=>{if("function"!=typeof error.json)return reject(error);error.json().then(err=>reject({message:_getErrorMessage(err),status:(null==error?void 0:error.status)||500}))},_getRequestParams=(method,options,parameters,body)=>{const params={method:method,headers:(null==options?void 0:options.headers)||{}};return"GET"===method?params:(params.headers=Object.assign({"Content-Type":"application/json"},null==options?void 0:options.headers),params.body=JSON.stringify(body),Object.assign(Object.assign({},params),parameters))};function _handleRequest(method,url,options,parameters,body){return __awaiter(this,void 0,void 0,function*(){return new Promise((resolve,reject)=>{cross_fetch_1.default(url,_getRequestParams(method,options,parameters,body)).then(result=>{if(!result.ok)throw result;return null!=options&&options.noResolveJson?resolve(result):result.json()}).then(data=>resolve(data)).catch(error=>handleError(error,reject))})})}exports.get=function(url,options,parameters){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("GET",url,options,parameters)})},exports.post=function(url,body,options,parameters){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("POST",url,options,parameters,body)})},exports.put=function(url,body,options,parameters){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("PUT",url,options,parameters,body)})},exports.remove=function(url,body,options,parameters){return __awaiter(this,void 0,void 0,function*(){return _handleRequest("DELETE",url,options,parameters,body)})}},{"cross-fetch":46}],35:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)};Object.defineProperty(exports,"__esModule",{value:!0}),__exportStar(require("./StorageBucketApi"),exports),__exportStar(require("./StorageFileApi"),exports),__exportStar(require("./types"),exports),__exportStar(require("./constants"),exports)},{"./StorageBucketApi":31,"./StorageFileApi":32,"./constants":33,"./types":36}],36:[function(require,module,exports){arguments[4][9][0].apply(exports,arguments)},{dup:9}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.version=void 0,exports.version="0.0.0"},{}],38:[function(require,module,exports){"use strict";var __awaiter=this&&this.__awaiter||function(thisArg,_arguments,P,generator){return new(P=P||Promise)(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){var value;result.done?resolve(result.value):((value=result.value)instanceof P?value:new P(function(resolve){resolve(value)})).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const constants_1=require("./lib/constants"),helpers_1=require("./lib/helpers"),SupabaseAuthClient_1=require("./lib/SupabaseAuthClient"),SupabaseQueryBuilder_1=require("./lib/SupabaseQueryBuilder"),storage_js_1=require("@supabase/storage-js"),postgrest_js_1=require("@supabase/postgrest-js"),realtime_js_1=require("@supabase/realtime-js"),DEFAULT_OPTIONS={schema:"public",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:constants_1.DEFAULT_HEADERS};exports.default=class{constructor(supabaseUrl,supabaseKey,settings){if(this.supabaseUrl=supabaseUrl,this.supabaseKey=supabaseKey,!supabaseUrl)throw new Error("supabaseUrl is required.");if(!supabaseKey)throw new Error("supabaseKey is required.");supabaseUrl=helpers_1.stripTrailingSlash(supabaseUrl);settings=Object.assign(Object.assign({},DEFAULT_OPTIONS),settings);this.restUrl=`${supabaseUrl}/rest/v1`,this.realtimeUrl=`${supabaseUrl}/realtime/v1`.replace("http","ws"),this.authUrl=`${supabaseUrl}/auth/v1`,this.storageUrl=`${supabaseUrl}/storage/v1`,this.schema=settings.schema,this.auth=this._initSupabaseAuthClient(settings),this.realtime=this._initRealtimeClient(settings.realtime)}get storage(){return new storage_js_1.SupabaseStorageClient(this.storageUrl,this._getAuthHeaders())}from(table){var url=`${this.restUrl}/${table}`;return new SupabaseQueryBuilder_1.SupabaseQueryBuilder(url,{headers:this._getAuthHeaders(),schema:this.schema,realtime:this.realtime,table:table})}rpc(fn,params,{head=!1,count=null}={}){const rest=this._initPostgRESTClient();return rest.rpc(fn,params,{head:head,count:count})}removeSubscription(subscription){return new Promise(resolve=>__awaiter(this,void 0,void 0,function*(){try{yield this._closeSubscription(subscription);var openSubscriptions=this.getSubscriptions().length;if(!openSubscriptions){var error=(yield this.realtime.disconnect())["error"];if(error)return resolve({error:error})}return resolve({error:null,data:{openSubscriptions:openSubscriptions}})}catch(error){return resolve({error:error})}}))}_closeSubscription(subscription){return __awaiter(this,void 0,void 0,function*(){subscription.isClosed()||(yield this._closeChannel(subscription))})}getSubscriptions(){return this.realtime.channels}_initSupabaseAuthClient({autoRefreshToken,persistSession,detectSessionInUrl,localStorage,headers}){var authHeaders={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new SupabaseAuthClient_1.SupabaseAuthClient({url:this.authUrl,headers:Object.assign(Object.assign({},headers),authHeaders),autoRefreshToken:autoRefreshToken,persistSession:persistSession,detectSessionInUrl:detectSessionInUrl,localStorage:localStorage})}_initRealtimeClient(options){return new realtime_js_1.RealtimeClient(this.realtimeUrl,Object.assign(Object.assign({},options),{params:Object.assign(Object.assign({},null==options?void 0:options.params),{apikey:this.supabaseKey})}))}_initPostgRESTClient(){return new postgrest_js_1.PostgrestClient(this.restUrl,{headers:this._getAuthHeaders(),schema:this.schema})}_getAuthHeaders(){const headers=constants_1.DEFAULT_HEADERS;var authBearer=null!==(authBearer=null===(authBearer=this.auth.session())||void 0===authBearer?void 0:authBearer.access_token)&&void 0!==authBearer?authBearer:this.supabaseKey;return headers.apikey=this.supabaseKey,headers.Authorization=`Bearer ${authBearer}`,headers}_closeChannel(subscription){return new Promise((resolve,reject)=>{subscription.unsubscribe().receive("ok",()=>(this.realtime.remove(subscription),resolve(!0))).receive("error",e=>reject(e))})}}},{"./lib/SupabaseAuthClient":40,"./lib/SupabaseQueryBuilder":41,"./lib/constants":43,"./lib/helpers":44,"@supabase/postgrest-js":12,"@supabase/realtime-js":22,"@supabase/storage-js":30}],39:[function(require,module,exports){"use strict";var __createBinding=this&&this.__createBinding||(Object.create?function(o,m,k,k2){void 0===k2&&(k2=k),Object.defineProperty(o,k2,{enumerable:!0,get:function(){return m[k]}})}:function(o,m,k,k2){o[k2=void 0===k2?k:k2]=m[k]}),__exportStar=this&&this.__exportStar||function(m,exports){for(var p in m)"default"===p||Object.prototype.hasOwnProperty.call(exports,p)||__createBinding(exports,m,p)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SupabaseClient=exports.createClient=void 0;const SupabaseClient_1=__importDefault(require("./SupabaseClient"));exports.SupabaseClient=SupabaseClient_1.default,__exportStar(require("@supabase/gotrue-js"),exports),__exportStar(require("@supabase/realtime-js"),exports);exports.createClient=(supabaseUrl,supabaseKey,options)=>new SupabaseClient_1.default(supabaseUrl,supabaseKey,options)},{"./SupabaseClient":38,"@supabase/gotrue-js":3,"@supabase/realtime-js":22}],40:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SupabaseAuthClient=void 0;class SupabaseAuthClient extends require("@supabase/gotrue-js").GoTrueClient{constructor(options){super(options)}}exports.SupabaseAuthClient=SupabaseAuthClient},{"@supabase/gotrue-js":3}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SupabaseQueryBuilder=void 0;var postgrest_js_1=require("@supabase/postgrest-js");const SupabaseRealtimeClient_1=require("./SupabaseRealtimeClient");class SupabaseQueryBuilder extends postgrest_js_1.PostgrestQueryBuilder{constructor(url,{headers={},schema,realtime,table}){super(url,{headers:headers,schema:schema}),this._subscription=new SupabaseRealtimeClient_1.SupabaseRealtimeClient(realtime,headers,schema,table),this._realtime=realtime}on(event,callback){return this._realtime.isConnected()||this._realtime.connect(),this._subscription.on(event,callback)}}exports.SupabaseQueryBuilder=SupabaseQueryBuilder},{"./SupabaseRealtimeClient":42,"@supabase/postgrest-js":12}],42:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SupabaseRealtimeClient=void 0;const realtime_js_1=require("@supabase/realtime-js");exports.SupabaseRealtimeClient=class{constructor(socket,userToken,schema,topic){const chanParams={};topic="*"===topic?`realtime:${schema}`:`realtime:${schema}:${topic}`,userToken=userToken.Authorization.split(" ")[1];userToken&&(chanParams.user_token=userToken),this.subscription=socket.channel(topic,chanParams)}getPayloadRecords(payload){const records={new:{},old:{}};return"INSERT"!==payload.type&&"UPDATE"!==payload.type||(records.new=realtime_js_1.Transformers.convertChangeData(payload.columns,payload.record)),"UPDATE"!==payload.type&&"DELETE"!==payload.type||(records.old=realtime_js_1.Transformers.convertChangeData(payload.columns,payload.old_record)),records}on(event,callback){return this.subscription.on(event,payload=>{var enrichedPayload={schema:payload.schema,table:payload.table,commit_timestamp:payload.commit_timestamp,eventType:payload.type,new:{},old:{}},enrichedPayload=Object.assign(Object.assign({},enrichedPayload),this.getPayloadRecords(payload));callback(enrichedPayload)}),this}subscribe(callback=()=>{}){return this.subscription.onError(e=>callback("SUBSCRIPTION_ERROR",e)),this.subscription.onClose(()=>callback("CLOSED")),this.subscription.subscribe().receive("ok",()=>callback("SUBSCRIBED")).receive("error",e=>callback("SUBSCRIPTION_ERROR",e)).receive("timeout",()=>callback("RETRYING_AFTER_TIMEOUT")),this.subscription}}},{"@supabase/realtime-js":22}],43:[function(version_1,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_HEADERS=void 0;version_1=version_1("./version");exports.DEFAULT_HEADERS={"X-Client-Info":`supabase-js/${version_1.version}`}},{"./version":45}],44:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.stripTrailingSlash=exports.uuid=void 0,exports.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"==c?r:3&r|8).toString(16)})},exports.stripTrailingSlash=function(url){return url.replace(/\/$/,"")}},{}],45:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.version=void 0,exports.version="1.24.0"},{}],46:[function(require,module,exports){var global="undefined"!=typeof self?self:this,ctx=(F.prototype=global,new F);function F(){this.fetch=!1,this.DOMException=global.DOMException}!function(self){!function(exports){var viewClasses,isArrayBufferView,support_searchParams="URLSearchParams"in self,support_iterable="Symbol"in self&&"iterator"in Symbol,support_blob="FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(e){return!1}}(),support_formData="FormData"in self,support_arrayBuffer="ArrayBuffer"in self;function normalizeName(name){if("string"!=typeof name&&(name=String(name)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(name))throw new TypeError("Invalid character in header field name");return name.toLowerCase()}function normalizeValue(value){return value="string"!=typeof value?String(value):value}function iteratorFor(items){var iterator={next:function(){var value=items.shift();return{done:void 0===value,value:value}}};return support_iterable&&(iterator[Symbol.iterator]=function(){return iterator}),iterator}function Headers(headers){this.map={},headers instanceof Headers?headers.forEach(function(value,name){this.append(name,value)},this):Array.isArray(headers)?headers.forEach(function(header){this.append(header[0],header[1])},this):headers&&Object.getOwnPropertyNames(headers).forEach(function(name){this.append(name,headers[name])},this)}function consumed(body){if(body.bodyUsed)return Promise.reject(new TypeError("Already read"));body.bodyUsed=!0}function fileReaderReady(reader){return new Promise(function(resolve,reject){reader.onload=function(){resolve(reader.result)},reader.onerror=function(){reject(reader.error)}})}function readBlobAsArrayBuffer(blob){var reader=new FileReader,promise=fileReaderReady(reader);return reader.readAsArrayBuffer(blob),promise}function bufferClone(buf){if(buf.slice)return buf.slice(0);var view=new Uint8Array(buf.byteLength);return view.set(new Uint8Array(buf)),view.buffer}function Body(){return this.bodyUsed=!1,this._initBody=function(body){var obj;(this._bodyInit=body)?"string"==typeof body?this._bodyText=body:support_blob&&Blob.prototype.isPrototypeOf(body)?this._bodyBlob=body:support_formData&&FormData.prototype.isPrototypeOf(body)?this._bodyFormData=body:support_searchParams&&URLSearchParams.prototype.isPrototypeOf(body)?this._bodyText=body.toString():support_arrayBuffer&&support_blob&&((obj=body)&&DataView.prototype.isPrototypeOf(obj))?(this._bodyArrayBuffer=bufferClone(body.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):support_arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(body)||isArrayBufferView(body))?this._bodyArrayBuffer=bufferClone(body):this._bodyText=body=Object.prototype.toString.call(body):this._bodyText="",this.headers.get("content-type")||("string"==typeof body?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):support_searchParams&&URLSearchParams.prototype.isPrototypeOf(body)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},support_blob&&(this.blob=function(){var rejected=consumed(this);if(rejected)return rejected;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?consumed(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(readBlobAsArrayBuffer)}),this.text=function(){var blob,reader,promise=consumed(this);if(promise)return promise;if(this._bodyBlob)return blob=this._bodyBlob,reader=new FileReader,promise=fileReaderReady(reader),reader.readAsText(blob),promise;if(this._bodyArrayBuffer)return Promise.resolve(function(buf){for(var view=new Uint8Array(buf),chars=new Array(view.length),i=0;i<view.length;i++)chars[i]=String.fromCharCode(view[i]);return chars.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},support_formData&&(this.formData=function(){return this.text().then(decode)}),this.json=function(){return this.text().then(JSON.parse)},this}support_arrayBuffer&&(viewClasses=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],isArrayBufferView=ArrayBuffer.isView||function(obj){return obj&&-1<viewClasses.indexOf(Object.prototype.toString.call(obj))}),Headers.prototype.append=function(name,value){name=normalizeName(name),value=normalizeValue(value);var oldValue=this.map[name];this.map[name]=oldValue?oldValue+", "+value:value},Headers.prototype.delete=function(name){delete this.map[normalizeName(name)]},Headers.prototype.get=function(name){return name=normalizeName(name),this.has(name)?this.map[name]:null},Headers.prototype.has=function(name){return this.map.hasOwnProperty(normalizeName(name))},Headers.prototype.set=function(name,value){this.map[normalizeName(name)]=normalizeValue(value)},Headers.prototype.forEach=function(callback,thisArg){for(var name in this.map)this.map.hasOwnProperty(name)&&callback.call(thisArg,this.map[name],name,this)},Headers.prototype.keys=function(){var items=[];return this.forEach(function(value,name){items.push(name)}),iteratorFor(items)},Headers.prototype.values=function(){var items=[];return this.forEach(function(value){items.push(value)}),iteratorFor(items)},Headers.prototype.entries=function(){var items=[];return this.forEach(function(value,name){items.push([name,value])}),iteratorFor(items)},support_iterable&&(Headers.prototype[Symbol.iterator]=Headers.prototype.entries);var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Request(upcased,options){var method,body=(options=options||{}).body;if(upcased instanceof Request){if(upcased.bodyUsed)throw new TypeError("Already read");this.url=upcased.url,this.credentials=upcased.credentials,options.headers||(this.headers=new Headers(upcased.headers)),this.method=upcased.method,this.mode=upcased.mode,this.signal=upcased.signal,body||null==upcased._bodyInit||(body=upcased._bodyInit,upcased.bodyUsed=!0)}else this.url=String(upcased);if(this.credentials=options.credentials||this.credentials||"same-origin",!options.headers&&this.headers||(this.headers=new Headers(options.headers)),this.method=(method=options.method||this.method||"GET",upcased=method.toUpperCase(),-1<methods.indexOf(upcased)?upcased:method),this.mode=options.mode||this.mode||null,this.signal=options.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&body)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(body)}function decode(body){var form=new FormData;return body.trim().split("&").forEach(function(name){var value;name&&(name=(value=name.split("=")).shift().replace(/\+/g," "),value=value.join("=").replace(/\+/g," "),form.append(decodeURIComponent(name),decodeURIComponent(value)))}),form}function Response(bodyInit,options){options=options||{},this.type="default",this.status=void 0===options.status?200:options.status,this.ok=200<=this.status&&this.status<300,this.statusText="statusText"in options?options.statusText:"OK",this.headers=new Headers(options.headers),this.url=options.url||"",this._initBody(bodyInit)}Request.prototype.clone=function(){return new Request(this,{body:this._bodyInit})},Body.call(Request.prototype),Body.call(Response.prototype),Response.prototype.clone=function(){return new Response(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new Headers(this.headers),url:this.url})},Response.error=function(){var response=new Response(null,{status:0,statusText:""});return response.type="error",response};var redirectStatuses=[301,302,303,307,308];Response.redirect=function(url,status){if(-1===redirectStatuses.indexOf(status))throw new RangeError("Invalid status code");return new Response(null,{status:status,headers:{location:url}})},exports.DOMException=self.DOMException;try{new exports.DOMException}catch(err){exports.DOMException=function(error,name){this.message=error,this.name=name;error=Error(error);this.stack=error.stack},exports.DOMException.prototype=Object.create(Error.prototype),exports.DOMException.prototype.constructor=exports.DOMException}function fetch(input,init){return new Promise(function(resolve,reject){var request=new Request(input,init);if(request.signal&&request.signal.aborted)return reject(new exports.DOMException("Aborted","AbortError"));var xhr=new XMLHttpRequest;function abortXhr(){xhr.abort()}xhr.onload=function(){var headers,options={status:xhr.status,statusText:xhr.statusText,headers:(body=xhr.getAllResponseHeaders()||"",headers=new Headers,body.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach(function(key){var value=key.split(":"),key=value.shift().trim();key&&(value=value.join(":").trim(),headers.append(key,value))}),headers)};options.url="responseURL"in xhr?xhr.responseURL:options.headers.get("X-Request-URL");var body="response"in xhr?xhr.response:xhr.responseText;resolve(new Response(body,options))},xhr.onerror=function(){reject(new TypeError("Network request failed"))},xhr.ontimeout=function(){reject(new TypeError("Network request failed"))},xhr.onabort=function(){reject(new exports.DOMException("Aborted","AbortError"))},xhr.open(request.method,request.url,!0),"include"===request.credentials?xhr.withCredentials=!0:"omit"===request.credentials&&(xhr.withCredentials=!1),"responseType"in xhr&&support_blob&&(xhr.responseType="blob"),request.headers.forEach(function(value,name){xhr.setRequestHeader(name,value)}),request.signal&&(request.signal.addEventListener("abort",abortXhr),xhr.onreadystatechange=function(){4===xhr.readyState&&request.signal.removeEventListener("abort",abortXhr)}),xhr.send(void 0===request._bodyInit?null:request._bodyInit)})}fetch.polyfill=!0,self.fetch||(self.fetch=fetch,self.Headers=Headers,self.Request=Request,self.Response=Response),exports.Headers=Headers,exports.Request=Request,exports.Response=Response,exports.fetch=fetch,Object.defineProperty(exports,"__esModule",{value:!0})}({})}(ctx),ctx.fetch.ponyfill=!0,delete ctx.fetch.polyfill;(exports=ctx.fetch).default=ctx.fetch,exports.fetch=ctx.fetch,exports.Headers=ctx.Headers,exports.Request=ctx.Request,exports.Response=ctx.Response,module.exports=exports},{}],47:[function(require,module,exports){function naiveFallback(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")}module.exports=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(error){return naiveFallback()}try{return __global__?__global__:naiveFallback()}finally{delete Object.prototype.__global__}}()},{}],48:[function(websocket_version,module,exports){var _globalThis;if("object"==typeof globalThis)_globalThis=globalThis;else try{_globalThis=websocket_version("es5-ext/global")}catch(error){}finally{if(!(_globalThis=!_globalThis&&"undefined"!=typeof window?window:_globalThis))throw new Error("Could not determine global this")}var NativeWebSocket=_globalThis.WebSocket||_globalThis.MozWebSocket,websocket_version=websocket_version("./version");function W3CWebSocket(native_instance,protocols){native_instance=protocols?new NativeWebSocket(native_instance,protocols):new NativeWebSocket(native_instance);return native_instance}NativeWebSocket&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(prop){Object.defineProperty(W3CWebSocket,prop,{get:function(){return NativeWebSocket[prop]}})}),module.exports={w3cwebsocket:NativeWebSocket?W3CWebSocket:null,version:websocket_version}},{"./version":49,"es5-ext/global":47}],49:[function(require,module,exports){module.exports=require("../package.json").version},{"../package.json":50}],50:[function(require,module,exports){module.exports={name:"websocket",description:"Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords:["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author:"Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors:["Iaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version:"1.0.34",repository:{type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage:"https://github.com/theturtle32/WebSocket-Node",engines:{node:">=4.0.0"},dependencies:{bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies:{"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config:{verbose:!1},scripts:{test:"tape test/unit/*.js",gulp:"gulp"},main:"index",directories:{lib:"./lib"},browser:"lib/browser.js",license:"Apache-2.0"}},{}],51:[function(require,module,exports){"use strict";var supabase=(0,require("@supabase/supabase-js").createClient)("https://yjjqcbwwpdxdbnyhbwme.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlhdCI6MTYzMjk4Mjg1OCwiZXhwIjoxOTQ4NTU4ODU4fQ.uclyC8mUUCjXai6nlEyZAwDit1A0cDiqLrJCCChHsXI"),f=function(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b},normalize=function(url){return url=(url=url.startsWith("www.")?url.slice(4):url).endsWith("/")?url.slice(0,1):url},getCurrentURL=function(){var url=window.location.hostname+window.location.pathname;return normalize(url)};function init(ip){function track(events){events={id:f(),url:url,ip:ip,action:events,timestamp:(new Date).toJSON()},console.log("tracking",events),events=[events],supabase.from("events").insert(events).then(console.log).catch(console.error)}var url=getCurrentURL();function addConversionListener(_ref2){var type=_ref2.type,trigger=_ref2.trigger;switch(type){case"click":Array.from(document.getElementsByClassName(trigger)).forEach(function(e){e.addEventListener("click",function(){return track("click")},{once:!0})});break;case"view":normalize(trigger)===normalize(url)&&track("view")}}supabase.from("experiments").select("*, redirects ( destination )").filter("redirects.destination","eq",getCurrentURL()).then(function(_ref){return _ref.data}).then(function(experiments){return experiments.forEach(addConversionListener)})}fetch("https://api.ipify.org").then(function(r){return r.text()}).then(init)},{"@supabase/supabase-js":39}]},{},[51])(51)});